# 宽表的设计

在实际的开发中，对于相同的业务不同的开发人员可能有着不同的设计，常常会因此发生一些争议。为了理清楚这些争议，我们需要了解不同的设计之间的利弊，针对利弊来做出取舍。

这一篇文档用以描述宽表的设计，包括其特点以及适用场景。

## 什么是宽表 {id="what"}

什么是宽表模式呢？就是将一个对象的所有的属性都存储在一个表当中。下面我们以课程表举例:

| 课程名称(PK) | 课程类型 | 讲师名称    | 讲师职位 |
|----------|------|---------|------|
| MySQL基础  | 数据库  | MySQLer | 高级   |
| MySQL进阶  | 数据库  | MySQLer | 高级   |
| PHP基础    | PHP  | PHPer   | 中级   |
| PHP进阶    | PHP  | PHPer   | 中级   |


在宽表模式中，课程信息和讲师的信息都放在同一张表中。这样的设计非常容易也方便阅读，大量减少了多表设计中的关联关系，所以复杂度也大大降低。

## 数据冗余 {id="data-redundancy"}

首先，这样的设计存在**数据的冗余**。相同的数据在一张表中出现了多次，比如说讲师的名称、课程的类型以及讲师的职位。如果数据量比较大，那占用的空间也会随之比较大。

数据冗余也会大大增加维护的压力，比如我们要更新讲师 MySQLer 的名称为 iMySQLer。那么我们就需要更新两行数据，如果有一行没有更新，则会造成**数据不一致**。

## 更新异常 {id="update-exception"}

接着，这样的设计存在**更新异常**，当修改一行中某列的值时，同时修改了多行数据。

比如说，我想更新 “PHP进阶” 课程的讲师职位为“高级”，写下了如下的 SQL:

```sql
update 课程表 set 讲师职位 = ‘高级’ where 课程名称 = ‘PHP进阶’;
```

这条 SQL 执行之后，会引发数据不一致，有的课程中的名为“PHPer”的讲师的讲师职位是中级而有的是高级，而我们知道一个讲师的职位是不可能同时为中级和高级的。

## 插入异常 {id="insert-exception"}

接着，这样的设计存在**插入异常**，部分数据由于缺失主键而无法写入表中。

在上面的表中，课程名称字段是主键。但是如果我想新增一名讲师，而这个讲师暂时没有发表课程的话，这样数据会因为没有主键而插入失败。即，下面这样的 SQL 是执行失败的:

```sql
insert into 课程表 (讲师名称，讲师职位) value ('iJava', '高级');
```

所以，我们说这样的设计是存在插入异常的。

## 删除异常 {id="delete-exception"}

接着，这样的设计存在**删除异常**，删除某一数据时不得不删除另一数据。

比如，我想删除“PHP基础”和“PHP进阶”两门课程，所以写了如下的 SQL：

```sql
delete from 课程表 where 课程名称 = 'PHP基础' or 课程名称 = 'PHP进阶';
```

在执行这条 SQL 之后，我么发现出了这两门课程被删除以外，名称为 “PHPer” 的讲师的相关信息也被删除了。这就是删除异常。

## 宽表的适用场景 {id="scene"}

宽表这种设计适用于如下场景：

- 配合列存储的数据报表应用，因为报表应用用于数据的展示，即使存在相关异常也不会有太大问题，也会提升数据查询的性能。

## 总结 {id="summary"}

这一篇文档描述了宽表的设计，什么是宽表设计？将一个对象的所有信息都存放在一张表中。

宽表设计存在的一些问题，包括数据冗余、更新异常、插入异常以及删除异常。

宽表设计的应用场景，非常适合报表相关的表设计。