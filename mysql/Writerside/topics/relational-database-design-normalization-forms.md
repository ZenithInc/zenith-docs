# 关系型数据库设计范式

数据库的范式，在面试中经常被提起，在实际的开发过程中，也有很多应用的并不好的地方。什么场景下应该运用范式，什么场景下可以不讲究范式、范式的优缺点是什么？这篇文档来讲讲范式，希望能将它讲明白。

在关系型数据库中，目前流行 6 种范式，第一范式(1NF)、第二范式(2NF)、第三范式(3NF)、第四范式(4NF)、巴德思科范式(BCNF)、第四范式(4NF)以及第五范式(5NF)。分别是下文中将分别介绍。

## 第一范式(1NF) {id="1NF"}

在很多的资料中，都有类似的描述：关系型数据库必须满足第一范式。我想这句话并不是绝对的，我们首先来看看什么是第一范式(1NF)。

如果要符合第一范式需要满足下面三个条件:

1. 一行记录需要有唯一标示，即不允许出现两行相同的记录。
2. 一行中任意一列的值，必须符合原子性，不能有多个含义。
3. 不能使用多个字段表达一个意思。

下面举例描述几个不符合第一范式的例子:

| 商品名称    | 商品库存 |
|---------|------|
| iPhone4 | 24   |
| iPhone4 | 24   |


不满足的原因是出现了重复的行，符合范式的做法是添加主键，因为主键具有唯一性，可以使用主键查找定位任意一行。

下面的例子是用户购买商品的表，如下设计:

| 用户 | 购买的商品       |
|----|-------------|
| 小王 | 商品A，商品B，商品C |
| 小李 | 商品B，商品C     |


不满足的原因是“购买的商品”字段的值得含义并不唯一，试想如何查询商品B有哪些用户购买了？符合范式的做法如下:

| 用户 | 购买的商品 |
|----|-------|
| 小王 | 商品A   |
| 小王 | 商品B   |
| 小王 | 商品C   |
| 小李 | 商品B   |
| 小李 | 商品C   |


在举一个不合符范式的例子，比如我们在商城中需要存储用户的送货地址。大多数商城只允许用户保存指定数量的地址,设计如下:

| 用户 | 地址1  | 地址2  | 地址3  |
|----|------|------|------|
| 小王 | 公司地址 | 家庭地址 | 老家地址 |

不满足的原因是使用多个字段(指地址)来相同的意义，试想我想知道那些人有保存了相同的地址怎么查询？符合范式的做法:

| 用户 | 地址   |
|----|------|
| 小王 | 公司地址 |
| 小王 | 家庭地址 |
| 小王 | 老家地址 |


## 第二范式(2NF) {id="2NF"}

第二范式是基于第一范式的，即第二范式必须符合第一范式。

在第一范式的基础上，第二范式除了主键和候选键之后，其他的字段都必须全部依赖于主键和候选键。

下面这张表的设计是符合第一范式却不符合第二范式的:

| 用户ID | 用户名称 | 商品ID | 商品名称    |
|------|------|------|---------|
| 1    | 小王   | 2    | iPhone4 |
| 2    | 小红   | 2    | iPhone5 |


从上面的示例中我们可以看到，决定一条记录唯一的键是用户ID和商品ID，而用户名是依赖于用户ID的，商品名称是依赖于商品ID的。这是不符合第二范式的。符合范式的做法是将这一张表拆分为两张表，如下：

| 用户ID | 用户名称 |
|------|------|
| 1    | 小王   |
| 2    | 小红   |

| 商品ID | 商品名称    |
|------|---------|
| 2    | iPhone4 |

| 用户ID | 商品ID |
|------|------|
| 1    | 2    |
| 2    | 2    |


## 第三范式(3NF) {id="3NF"}

第三范式是建立在第一和第二范式之上的，也就是说必须首先满足第一和第二范式。第三范式要求表中的非主键列之间不能相互依赖。

先看如下课程表的例子:

| 课程标题(PK) | 课程分类   | 讲师名称    | 讲师职位 | 课程评分 |
|----------|--------|---------|------|------|
| MySQL 面试 | MySQL  | MySQLer | 高级   | 8    |
| MyCat    | 数据库中间件 | MySQLer | 高级   | 10   |


首先，这张表是满足第一范式的，表中的每一个字段都不可再分。然后，这张表也是满足第二范式的，除了主键和候选键之后，其他的字段都必须全部依赖于主键和候选键。

但是这张表并不满足于第三范式，课程分类列和讲师名称列是依赖于课程表的主键(课程标题)的。但是讲师职位并不依赖于课程表的主键而是依赖于讲师名称的。

修改就是将课程信息和讲师信息拆分成两张表。

## 其他范式 {id="other"}

除此之外，还有 BCNF、4NF、5NF、6NF。但是在实际的生产中，不会严格遵守上面所属的范式，经常会出现一些反范式的设计。

**但是，需要注意的是，很多
开发人员觉得范式没有用。这种观点是错误的，我们关系型数据库的设计，基本结构还是遵守范式的，只是局部使用反范式来方便查询**。